<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Workflow • rater</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Workflow">
<meta property="og:description" content="rater">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rater</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.9001</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/workflow.html">rater workflow</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Voltemand/rater">
    <span class="fa fa-lg fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="workflow_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jeffreypullin/rater/blob/master/vignettes/workflow.Rmd"><code>vignettes/workflow.Rmd</code></a></small>
      <div class="hidden name"><code>workflow.Rmd</code></div>

    </div>

    
    
<div id="what-is-rater" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-rater" class="anchor"></a>What is rater?</h2>
<p>The <strong>rater</strong> package is designed to allow easy fitting and analysis of Bayesian models of categorical data annotation using <a href="http://mc-stan.org/">Stan</a>. Here we demonstrate the basic workflow for using the package.</p>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>We will use the <em>anesthesia</em> data set taken from the paper <em>Maximum Likelihood Estimation of Observer Error-Rates Using the EM Algorithm</em> by A. P. Dawid and A. M. Skene, the paper which introduced the type of models used in this package. This dataset is included in <strong>rater</strong>. Run:</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="co"># load the rater package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://jeffreypullin.github.io/rater">rater</a></span>)
</pre></div>
<pre><code>#&gt; * The rater package uses `Stan` to fit bayesian models.
#&gt; * If you are working on a local, multicore CPU with excess RAM please call:
#&gt; * options(mc.cores = parallel::detectCores())
#&gt; * This will allow Stan to run inference on multiple cores in parallel.</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"anesthesia"</span>)
</pre></div>
<p>to load the data. The data comes in the form of a numeric matrix with three columns <code>item_index</code>, <code>rater_index</code> and <code>rating</code>. In the nomenclature of the package we would descibe this as <em>long</em> data. (For further information about data types see: <strong>link</strong>). We need to annotate this data as being long_data before we can use it for mode fitting. We do this using the command:</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="co">#anesthesia &lt;- long_data(anesthesia)</span>
</pre></div>
</div>
<div id="mcmc" class="section level2">
<h2 class="hasAnchor">
<a href="#mcmc" class="anchor"></a>mcmc()</h2>
<p>The core function of the <strong>rater</strong> package is the <code>mcmc()</code> function which fits a model to given data. This function has two arguments: <code>data</code>, data annotated as being in an appropriate format and <code>model</code>, which specifies the model you would like to fit.</p>
<p>Currently we support Multinomial, Dawid and Skene and Hierachical Dawid and Skene models in the package. Models are specifed as a function with the name of the model you woudld like to fit.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># fit the model using MCMC via Stan </span>
<span class="kw">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rater.html">rater</a></span>(<span class="kw">anesthesia</span>, <span class="fu"><a href="../reference/models.html">dawid_skene</a></span>(), iter = <span class="fl">500</span>, chains = <span class="fl">1</span>)
</pre></div>
<pre><code>#&gt; 
#&gt; SAMPLING FOR MODEL 'dawid_skene' NOW (CHAIN 1).
#&gt; Chain 1: 
#&gt; Chain 1: Gradient evaluation took 0.000238 seconds
#&gt; Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 2.38 seconds.
#&gt; Chain 1: Adjust your expectations accordingly!
#&gt; Chain 1: 
#&gt; Chain 1: 
#&gt; Chain 1: Iteration:   1 / 500 [  0%]  (Warmup)
#&gt; Chain 1: Iteration:  50 / 500 [ 10%]  (Warmup)
#&gt; Chain 1: Iteration: 100 / 500 [ 20%]  (Warmup)
#&gt; Chain 1: Iteration: 150 / 500 [ 30%]  (Warmup)
#&gt; Chain 1: Iteration: 200 / 500 [ 40%]  (Warmup)
#&gt; Chain 1: Iteration: 250 / 500 [ 50%]  (Warmup)
#&gt; Chain 1: Iteration: 251 / 500 [ 50%]  (Sampling)
#&gt; Chain 1: Iteration: 300 / 500 [ 60%]  (Sampling)
#&gt; Chain 1: Iteration: 350 / 500 [ 70%]  (Sampling)
#&gt; Chain 1: Iteration: 400 / 500 [ 80%]  (Sampling)
#&gt; Chain 1: Iteration: 450 / 500 [ 90%]  (Sampling)
#&gt; Chain 1: Iteration: 500 / 500 [100%]  (Sampling)
#&gt; Chain 1: 
#&gt; Chain 1:  Elapsed Time: 0.84948 seconds (Warm-up)
#&gt; Chain 1:                0.59707 seconds (Sampling)
#&gt; Chain 1:                1.44655 seconds (Total)
#&gt; Chain 1:</code></pre>
<pre><code>#&gt; Warning: The largest R-hat is 1.06, indicating chains have not mixed.
#&gt; Running the chains for more iterations may help. See
#&gt; http://mc-stan.org/misc/warnings.html#r-hat</code></pre>
<pre><code>#&gt; Warning: Bulk Effective Samples Size (ESS) is too low, indicating posterior means and medians may be unreliable.
#&gt; Running the chains for more iterations may help. See
#&gt; http://mc-stan.org/misc/warnings.html#bulk-ess</code></pre>
<pre><code>#&gt; Warning: Tail Effective Samples Size (ESS) is too low, indicating posterior variances and tail quantiles may be unreliable.
#&gt; Running the chains for more iterations may help. See
#&gt; http://mc-stan.org/misc/warnings.html#tail-ess</code></pre>
<p>You will see the normal progress output you get whenever <strong>Stan</strong> is sampling. Note that all models are compiled when the package is installed, rather than at runtime, meaning that you will not need to wait for a model to be compiled when running analyses.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>You can also compute MAP esitmates by specifiying <code>method = "optim"</code>in the <code>rater</code> function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rater.html">rater</a></span>(<span class="kw">anesthesia</span>, <span class="fu"><a href="../reference/models.html">dawid_skene</a></span>(), method = <span class="st">"optim"</span>)
</pre></div>
<pre><code>#&gt; Warning in .local(object, ...): non-zero return code in optimizing</code></pre>
<p>If you would like to change the prior parameters of the models you can do this by passing appropriate paraemters to the model function. For example to fit the dawid and skene model with prior parameter <span class="math inline">\(\alpha\)</span> <code>= c(4, 4, 4, 4)</code> you would run:</p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rater.html">rater</a></span>(<span class="kw">anesthesia</span>, <span class="fu"><a href="../reference/models.html">dawid_skene</a></span>(alpha = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">4</span>)))
</pre></div>
</div>
<div id="plot" class="section level2">
<h2 class="hasAnchor">
<a href="#plot" class="anchor"></a>plot()</h2>
<p>Having fit the Dawid and Skene model to the data we can now plot and extract key parameter estimates from the model.</p>
<p>To plot the population prevalence estimates (the parameter <span class="math inline">\(\pi\)</span> in the model) we run:</p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fit</span>, type = <span class="st">"pi"</span>) <span class="co"># or plot(fit, type = "prevalence")</span>
</pre></div>
<pre><code>#&gt; [[1]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<pre><code>#&gt; 
#&gt; [[2]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-6-2.png" width="576"></p>
<pre><code>#&gt; 
#&gt; [[3]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-6-3.png" width="576"></p>
<p>To plot the probalistic confusion matrices of the raters (the parameter <span class="math inline">\(\theta\)</span> in the model) we run:</p>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fit</span>, type = <span class="st">"theta"</span>) <span class="co"># or plot(fit, type = "raters")</span>
</pre></div>
<pre><code>#&gt; [[1]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-7-1.png" width="576"></p>
<pre><code>#&gt; 
#&gt; [[2]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-7-2.png" width="576"></p>
<pre><code>#&gt; 
#&gt; [[3]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-7-3.png" width="576"></p>
<p>To plot the latent class estimates (the parameter <span class="math inline">\(z\)</span> in the model) we run:</p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span>(<span class="kw">fit</span>, type = <span class="st">"z"</span>) <span class="co"># or plot(fit, "latent_class")</span>
</pre></div>
<pre><code>#&gt; [[1]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<pre><code>#&gt; 
#&gt; [[2]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-8-2.png" width="576"></p>
<pre><code>#&gt; 
#&gt; [[3]]</code></pre>
<p><img src="workflow_files/figure-html/unnamed-chunk-8-3.png" width="576"></p>
<p>For a discussion of what these parameters in the model represent, please see the vignette <strong>models</strong>.</p>
</div>
<div id="extract" class="section level2">
<h2 class="hasAnchor">
<a href="#extract" class="anchor"></a>extract</h2>
<p>Similarly, we can extract all of the estimates used to make these plots for further processing with the <code>extract</code> function:</p>
<div class="sourceCode" id="cb25"><pre class="downlit">
<span class="co"># extract_pi(fit)</span>
<span class="co"># </span>
<span class="co"># extract_theta(fit)</span>
<span class="co"># </span>
<span class="co"># extract_z(fit)</span>
</pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit">
<span class="kw">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rater.html">rater</a></span>(<span class="kw">anesthesia</span>, <span class="fu"><a href="../reference/models.html">dawid_skene</a></span>())
</pre></div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>In the example above we specified <strong>Stan</strong> to only run 1 chain with 500 iterations in order to speed up the creation of this vignette and reduce the volume of output. In general, we recommend running <code>mcmc()</code> using the <strong>Stan</strong> sampling defaults, which will be used if you only specify the <code>data</code> and <code>model</code> arguments in <code>mcmc()</code> i.e.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jeffrey Pullin, Damjan Vukcevic.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
